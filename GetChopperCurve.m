% Updated on May 15, 2003 to add PMT saturation correction and GetProfileList functions% change normalization range from 60-100 km to 50-100 km% change 8th order polyfit to 7th order polyfit.% update to save chopper curves to specific each day directory using formatted save command% string=sprinf(); save(string,'filename','-ascii')function[ChopperCurve]=GetChopperCurve(mdy,system,binwid,bino)% Get Profile List for Chopper Correctionsprintf('Input Chopper Correction Profiles:')csp=GetProfileList(system,mdy);[sizeofcsp,tmp]=size(csp);	% Initializationcsumsig=zeros(1,bino);% Sum for All the Profilesfor i=1:sizeofcsp	[csig,head(i,1:13)]=LoadDataFile(mdy,system,csp(i,1),csp(i,2),binwid);	Rawbino=head(i,9);	shots=head(i,10);		% shots number	% PMT saturation correction	csig=SaturationCorrect(csig,binwid,Rawbino,shots);	csumsig=csumsig+csig;end% Normalization wrt Chopper Fully Turned-on Range (60-100km)%csumsig=csumsig/mean(csumsig(round(60/binwid):round(100/binwid)));csumsig=csumsig/mean(csumsig(round(50/binwid):round(100/binwid)));% Polynomial Fit (8th order)FitRange1=1:round(60/binwid);%[k,s]=polyfit(FitRange1*binwid,csumsig(FitRange1),8);[k,s]=polyfit(FitRange1*binwid,csumsig(FitRange1),7);fit=polyval(k,FitRange1*binwid,s);% Plot for Choosing Chopper Turn-on Rangefigureplot(FitRange1*binwid,csumsig(FitRange1))gridaxis([0 60 0 1.5])% Make a List for Polynomial FitDisplayRange=input('Display Range for Fit Function (km) = ');DisplayRange=round(DisplayRange/binwid);[[DisplayRange(1):DisplayRange(2)]'*binwid,fit(DisplayRange(1):DisplayRange(2))']% Choose Chopper Fully Turned-on RangeTurnOnRange=input('Set Chopper Fully Turned on Altitude (km) = ');TurnOnRange=round(TurnOnRange/binwid); % Plot Chopper Turn-on Curve & Polynomial Fitfigureplot(FitRange1*binwid,csumsig(FitRange1),'y',[1:TurnOnRange]*binwid,fit(1:TurnOnRange),'r')xlabel('Range (km)')ylabel('Photon Cnts')gridaxis([0 60 0 1.5])title(sprintf('37%dnm Chopper Curve [%02d/%02d/%04d]',4/system,mdy))% Plot Chopper Curve above Turn-On RangeFitRange2=TurnOnRange:bino;figureplot(FitRange2*binwid,csumsig(FitRange2))gridaxis([20 200 .5 1.5])% Save Chopper CurveChopperCurve=ones(1,bino);ChopperCurve(1:TurnOnRange)=fit(1:TurnOnRange);month=mdy(1);day=mdy(2);yyear=mdy(3);yearyy=mdy(3)-1900;			% 4-digit yearssystem=['A','B'];						smonth=['JA';'FB';'MR';'AR';'MY';'JN';'JL';'AG';'SP';'OT';'NV';'DC'];if (yearyy>=100)	year=yearyy-100;else	year=yearyy;endif (system==1)	filename=sprintf('/Users/chu/Tiger/Projects/Rothera/RotheraDataAnalysis/%s%02d%02d/Data1/ChopperCurve374.dat',smonth(month,:),day,year);	save(filename, 'ChopperCurve','-ascii')else	filename=sprintf('/Users/chu/Tiger/Projects/Rothera/RotheraDataAnalysis/%s%02d%02d/Data1/ChopperCurve372.dat',smonth(month,:),day,year);	save(filename, 'ChopperCurve','-ascii')end	